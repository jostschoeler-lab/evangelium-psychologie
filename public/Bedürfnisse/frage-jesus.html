<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Frage Jesus, wie er dein Bed√ºrfnis stillen k√∂nnte ‚Äì Bibliothek (mobil)</title>
  <link rel="stylesheet" href="/assets/styles/main.css" />
  <style>
    body {
      margin: 0;
      background: linear-gradient(180deg, #fff1e4 0%, #e8fff7 100%);
      font-family: "Segoe UI", system-ui, sans-serif;
      color: #1f2933;
    }
    main {
      max-width: 480px;
      margin: 0 auto;
      padding: 24px 20px 48px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }
    header a {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      color: #3867d6;
      font-weight: 600;
    }
    .badge {
      background: rgba(32, 191, 107, 0.12);
      color: #0f7a53;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .card {
      background: #ffffffcc;
      backdrop-filter: blur(6px);
      border-radius: 28px;
      padding: 28px 22px;
      box-shadow: 0 24px 48px rgba(31, 61, 116, 0.16);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .hero {
      display: flex;
      justify-content: center;
    }
    .hero img {
      width: 168px;
      height: 168px;
      border-radius: 40px;
      box-shadow: 0 20px 36px rgba(75, 123, 236, 0.18);
      background: linear-gradient(135deg, #ffe0c7, #d5f9e5);
      padding: 12px;
    }
    h1 {
      font-size: 1.55rem;
      margin: 0;
      color: #2c3e50;
      text-align: center;
    }
    .subtitle {
      margin: 0;
      font-size: 1.05rem;
      line-height: 1.6;
      color: #344767;
      text-align: center;
    }
    .summary, .need-sections {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .summary {
      background: rgba(75, 123, 236, 0.08);
      border-radius: 20px;
      padding: 18px 20px;
    }
    .summary h2 {
      margin: 0;
      font-size: 1.05rem;
      color: #1f3c88;
    }
    .summary ul {
      margin: 0;
      padding-left: 1.1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      color: #2c3e50;
    }
    .summary li {
      line-height: 1.5;
      white-space: pre-line;
    }
    .need-sections {
      background: rgba(27, 163, 156, 0.12);
      border-radius: 20px;
      padding: 18px 20px;
    }
    .need-sections h2 {
      margin: 0;
      font-size: 1.05rem;
      color: #15775d;
    }
    .need-section {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .need-section h3 {
      margin: 0;
      font-size: 0.95rem;
      color: #1f3c88;
    }
    .need-section ul {
      margin: 0;
      padding-left: 1.1rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      color: #2c3e50;
    }
    blockquote {
      margin: 0;
      padding: 12px 16px;
      border-left: 4px solid #4b7bec;
      background: rgba(75, 123, 236, 0.1);
      border-radius: 16px;
      color: #1f3c88;
      font-style: italic;
    }
    button#openChat {
      border: none;
      border-radius: 999px;
      padding: 14px 20px;
      font-size: 1.05rem;
      font-weight: 700;
      background: linear-gradient(135deg, #4b7bec, #20bf6b);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 18px 34px rgba(75, 123, 236, 0.3);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    button#openChat:disabled {
      background: #cbd2d9;
      color: #5b728f;
      cursor: not-allowed;
      box-shadow: none;
    }
    a.secondary-link {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      text-decoration: none;
      border-radius: 999px;
      padding: 12px 18px;
      font-weight: 600;
      font-size: 0.95rem;
      background: rgba(32, 191, 107, 0.12);
      color: #15775d;
    }
    .hint {
      margin: 0;
      font-size: 0.95rem;
      line-height: 1.6;
      color: #4c5d73;
      text-align: center;
    }
    .warning {
      margin: 0;
      font-size: 0.9rem;
      color: #b5473a;
      background: rgba(255, 235, 230, 0.9);
      border-radius: 16px;
      padding: 12px 14px;
      display: none;
    }
    @media (max-width: 420px) {
      main {
        padding: 20px 16px 40px;
      }
      .hero img {
        width: 152px;
        height: 152px;
      }
    }
  </style>
</head>
<body>
  <main>
    <header>
      <a href="/Bed√ºrfnisse">‚Üê Zur√ºck</a>
      <span class="badge">Bibliothek ¬∑ Mobil</span>
    </header>
    <section class="card" aria-labelledby="askTitle">
      <div class="hero">
        <img src="./jesus-traegt-weinendes-kind.svg" alt="Jesus h√§lt ein weinendes Kind tr√∂stend im Arm" />
      </div>
      <h1 id="askTitle">üí¨ Frage Jesus, wie er dein Bed√ºrfnis stillen k√∂nnte</h1>
      <p class="subtitle">
        Diese Antwort ber√ºcksichtigt dein aktuelles Anliegen, das gew√§hlte Bed√ºrfnis, deine eigene Beschreibung
        und deine Kindheitserinnerung.
      </p>
      <div class="summary" id="summary" hidden>
        <h2>Dein Anliegen im √úberblick</h2>
        <ul></ul>
      </div>
      <div class="need-sections" id="needSections" hidden>
        <h2>Aus der Bed√ºrfnis-Erkl√§rung</h2>
      </div>
      <p class="warning" id="missingDataHint">
        F√ºlle zun√§chst dein Anliegen, das Bed√ºrfnis, deine pers√∂nliche Beschreibung und ‚Äì wenn m√∂glich ‚Äì deine Kindheitserinnerung in der Hauptansicht aus, damit Jesus dich gezielt ansprechen kann.
      </p>
      <button id="openChat" type="button">üí¨ ChatGPT-Antwort √∂ffnen</button>
      <a class="secondary-link" href="/Bed√ºrfnisse">üìö Zu den Bed√ºrfnissen</a>
      <p class="hint">
        üôè Setze dich im Glauben auf den Gnadenthron, wo Jesus als barmherziger Hohepriester sitzt. Stell dir vor, was er dir sagt und wie er dir jetzt Gnade schenkt. Meditiere 1‚Äì2 Minuten √ºber seine Worte und schreibe auf, was Jesus dir gesagt hat.
      </p>
    </section>
  </main>
  <script>
    (function () {
      const summaryEl = document.getElementById("summary");
      const summaryList = summaryEl.querySelector("ul");
      const needSectionsEl = document.getElementById("needSections");
      const openChatBtn = document.getElementById("openChat");
      const missingDataHint = document.getElementById("missingDataHint");

      const problem = (localStorage.getItem("bibliothekProblem") || "").trim();
      const selectedNeed = (() => {
        const raw = localStorage.getItem("bibliothekNeedDetails");
        if (!raw) return "";
        try {
          const parsed = JSON.parse(raw);
          if (parsed && typeof parsed.need === "string") {
            return parsed.need.trim();
          }
        } catch (error) {
          console.warn("Konnte Bed√ºrfnis nicht lesen", error);
        }
        return "";
      })();
      const personalNeed = (localStorage.getItem("bibliothekPersonalNeed") || "").trim();
      const childhood = (localStorage.getItem("bibliothekChildhoodExperience") || "").trim();

      const summaryItems = [
        problem && { label: "Was dich besch√§ftigt", value: problem },
        selectedNeed && { label: "Ausgew√§hltes Bed√ºrfnis", value: selectedNeed },
        personalNeed && { label: "Deine Beschreibung", value: personalNeed },
        childhood && { label: "Kindheitserinnerung", value: childhood }
      ].filter(Boolean);

      if (summaryItems.length > 0) {
        summaryEl.hidden = false;
        summaryItems.forEach((item) => {
          const li = document.createElement("li");
          li.innerHTML = `<strong>${item.label}:</strong> ${item.value}`;
          summaryList.appendChild(li);
        });
      }

      let needDetails = null;
      try {
        const raw = localStorage.getItem("bibliothekNeedDetails");
        if (raw) {
          const parsed = JSON.parse(raw);
          if (parsed && typeof parsed === "object") {
            needDetails = parsed;
          }
        }
      } catch (error) {
        console.warn("Konnte Bed√ºrfnisdetails nicht laden", error);
      }

      if (needDetails) {
        const sections = [];
        if (Array.isArray(needDetails.resonance) && needDetails.resonance.length > 0) {
          sections.push({ title: "üå± Resonanz-Hypothesen", items: needDetails.resonance });
        }
        if (Array.isArray(needDetails.dialog) && needDetails.dialog.length > 0) {
          sections.push({ title: "üó£Ô∏è Dialog-Impulse an Jesus", items: needDetails.dialog });
        }
        if (typeof needDetails.jesus === "string" && needDetails.jesus.trim().length > 0) {
          sections.push({ title: "‚úùÔ∏è Jesus-Antwort", items: [needDetails.jesus.trim()], blockquote: true });
        }

        if (sections.length > 0) {
          needSectionsEl.hidden = false;
          sections.forEach((section) => {
            const wrapper = document.createElement("div");
            wrapper.className = "need-section";
            const heading = document.createElement("h3");
            heading.textContent = section.title;
            wrapper.appendChild(heading);

            if (section.blockquote) {
              const quote = document.createElement("blockquote");
              quote.textContent = section.items[0];
              wrapper.appendChild(quote);
            } else {
              const list = document.createElement("ul");
              section.items.forEach((entry) => {
                const li = document.createElement("li");
                li.textContent = entry;
                list.appendChild(li);
              });
              wrapper.appendChild(list);
            }

            needSectionsEl.appendChild(wrapper);
          });
        }
      }

      const hasAskData = summaryItems.length > 0 || Boolean(needDetails);
      if (!hasAskData) {
        openChatBtn.disabled = true;
        missingDataHint.style.display = "block";
      }

      const buildDetailList = (items) =>
        items
          .map(({ label, value }) => {
            const trimmed = value.trim();
            if (!trimmed) {
              return "";
            }
            return `- ${label}: ${trimmed}`;
          })
          .filter(Boolean)
          .join("\n");

      const formatNeedExplanation = (details) => {
        if (!details) return "";
        const parts = [];
        if (Array.isArray(details.resonance) && details.resonance.length > 0) {
          const text = details.resonance.map((entry) => `  ‚Ä¢ ${entry}`).join("\n");
          parts.push(`Resonanz-Hypothesen:\n${text}`);
        }
        if (Array.isArray(details.dialog) && details.dialog.length > 0) {
          const text = details.dialog.map((entry) => `  ‚Ä¢ ${entry}`).join("\n");
          parts.push(`Dialog-Impulse an Jesus:\n${text}`);
        }
        if (typeof details.jesus === "string" && details.jesus.trim().length > 0) {
          parts.push(`Zusammenfassung der bisherigen Jesus-Antwort:\n  ‚Ä¢ ${details.jesus.trim()}`);
        }
        return parts.join("\n\n");
      };

      openChatBtn.addEventListener("click", () => {
        if (!hasAskData) {
          missingDataHint.style.display = "block";
          return;
        }

        const contextDetails = buildDetailList(
          [
            { label: "Was dich besch√§ftigt", value: problem },
            { label: "Ausgew√§hltes Bed√ºrfnis (aus der Liste)", value: selectedNeed },
            { label: "Pers√∂nliche Beschreibung des Bed√ºrfnisses", value: personalNeed },
            { label: "Kindheitserfahrungen zu diesem Gef√ºhl/Bed√ºrfnis", value: childhood }
          ].filter(Boolean)
        );

        const needExplanation = formatNeedExplanation(needDetails);

        const promptLines = [
          "Lies den folgenden Text, in dem ein Mensch sein inneres Bed√ºrfnis beschreibt.",
          "Antworte als Jesus ‚Äì liebevoll, wahrhaftig, ermutigend.",
          "Zeige, wie dieses Bed√ºrfnis in der Beziehung zu mir gestillt werden k√∂nnte,",
          "nicht durch √§u√üere Umst√§nde, sondern durch die Gemeinschaft mit mir.",
          "Schlage au√üerdem 2‚Äì3 Bibelverse vor, die unterst√ºtzen, wie ich dieses Bed√ºrfnis mit dir erlebe, und nenne die genaue Bibelstelle.",
          "Sprich in der Du-Form, sanft und pers√∂nlich, mit W√§rme.",
          "",
          "Angaben der Person:",
          contextDetails || "- (Der Mensch hat keine zus√§tzlichen Details hinterlassen.)"
        ];

        if (needExplanation) {
          promptLines.push("", "Bed√ºrfnis-Erkl√§rung aus der Bibliothek:", needExplanation);
        }

        const prompt = encodeURIComponent(promptLines.join("\n"));
        window.open(`https://chat.openai.com/?q=${prompt}`, "_blank", "noopener,noreferrer");
      });
    })();
  </script>
</body>
</html>
